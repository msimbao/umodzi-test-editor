<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz JSON Editor & Preview</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; display: flex; height: 100vh; }
    .left, .right { flex: 1; padding: 1rem; overflow-y: auto; border-right: 1px solid #ccc; }
    .right { border-right: none; }
    textarea, input, button, select { width: 100%; margin: 0.5rem 0; }
    .tabs { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .tab-btn { flex: 1; padding: 0.5rem; cursor: pointer; background: #eee; border: none; font-weight: bold; }
    .tab-btn.active { background: #ccc; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .question-box { margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="left">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('edit')">Paste JSON</button>
      <button class="tab-btn" onclick="switchTab('view')">View JSON</button>
    </div>
    <div id="edit" class="tab-content active">
      <textarea id="jsonInput" rows="30" placeholder="Paste your quiz JSON here..."></textarea>
      <button onclick="loadJson()">Load Quiz</button>
    </div>
    <div id="view" class="tab-content">
      <pre id="jsonView" style="white-space: pre-wrap;"></pre>
      <button onclick="copyJson()">Copy JSON</button>
    </div>
  </div>

  <div class="right">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchRightTab('preview')">Preview</button>
      <button class="tab-btn" onclick="switchRightTab('editForm')">Edit</button>
    </div>
    <div id="preview" class="tab-content active">
      <div id="quizPreview"></div>
    </div>
    <div id="editForm" class="tab-content">
      <h2>Editable Quiz Viewer</h2>
      <form id="quizForm"></form>
      <button onclick="saveQuiz()">Save</button>
    </div>
  </div>

  <script>
    let quizData = {};

    function switchTab(tabId) {
      document.querySelectorAll('.left .tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.left .tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`.left .tab-btn[onclick*='${tabId}']`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function switchRightTab(tabId) {
      document.querySelectorAll('.right .tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.right .tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`.right .tab-btn[onclick*='${tabId}']`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
      if (tabId === 'preview') MathJax.typesetPromise();
    }

    function copyJson() {
      navigator.clipboard.writeText(JSON.stringify(quizData, null, 2));
      alert('JSON copied to clipboard!');
    }

    function loadJson() {
      try {
        quizData = JSON.parse(document.getElementById('jsonInput').value);
        renderForm();
        renderPreview();
        updateJsonView();
      } catch (err) {
        alert('Invalid JSON');
      }
    }

    function renderForm() {
      const form = document.getElementById('quizForm');
      form.innerHTML = '';

      form.innerHTML += `<label>Title</label><input value="${quizData.title}" name="title">`;
      form.innerHTML += `<label>Description</label><input value="${quizData.description}" name="description">`;
      form.innerHTML += `<label>Grade</label><input value="${quizData.grade}" name="grade" type="number">`;
      form.innerHTML += `<label>Cost</label><input value="${quizData.cost}" name="cost" type="number">`;
      form.innerHTML += `<label>Estimated Time</label><input value="${quizData.estimatedTime}" name="estimatedTime" type="number">`;
      form.innerHTML += `<label>Total Questions</label><input value="${quizData.totalQuestions}" name="totalQuestions" type="number">`;

      quizData.questions.forEach((q, idx) => {
        const box = document.createElement('div');
        box.className = 'question-box';
        box.innerHTML = `
          <label>Q${idx + 1} Text</label>
          <input name="question-${idx}" value="${q.question.replace(/"/g, '&quot;')}">
        `;
        if (q.options && q.options.length > 0) {
          q.options.forEach((opt, i) => {
            box.innerHTML += `
              <label>Option ${i + 1}</label>
              <input name="option-${idx}-${i}" value="${opt.replace(/"/g, '&quot;')}">
            `;
          });
          box.innerHTML += `
            <label>Correct Answer Index</label>
            <input name="answer-${idx}" type="number" value="${q.answer}">
          `;
        } else if (q.answer) {
          box.innerHTML += `<label>Answer</label><input name="answer-${idx}" value="${q.answer}">`;
        }
        form.appendChild(box);
      });
    }

    function renderPreview() {
      const container = document.getElementById('quizPreview');
      container.innerHTML = `
        <h2>${quizData.title}</h2>
        <p><strong>Description:</strong> ${quizData.description}</p>
        <p><strong>Grade:</strong> ${quizData.grade}</p>
        <p><strong>Cost:</strong> ${quizData.cost}</p>
        <p><strong>Estimated Time:</strong> ${quizData.estimatedTime} minutes</p>
        <p><strong>Total Questions:</strong> ${quizData.totalQuestions}</p>
      `;
      quizData.questions.forEach((q, i) => {
        const box = document.createElement('div');
        box.className = 'question-box';
        box.innerHTML = `<div><strong>Q${i + 1}:</strong> ${q.question}</div>`;
        if (q.non_question) return container.appendChild(box);
        if (q.options && q.options.length > 0) {
          q.options.forEach((opt, j) => {
            const isCorrect = j === q.answer;
            box.innerHTML += `<div style="margin-left:1rem;color:${isCorrect ? 'green' : 'black'}">${opt}</div>`;
          });
        } else if (q.answer) {
          box.innerHTML += `<div style="margin-left:1rem;"><strong>Answer:</strong> ${q.answer}</div>`;
        }
        container.appendChild(box);
      });
      MathJax.typesetPromise();
    }

    function saveQuiz() {
      const formData = new FormData(document.getElementById('quizForm'));

      quizData.title = formData.get('title');
      quizData.description = formData.get('description');
      quizData.grade = parseInt(formData.get('grade'));
      quizData.cost = parseInt(formData.get('cost'));
      quizData.estimatedTime = parseInt(formData.get('estimatedTime'));
      quizData.totalQuestions = parseInt(formData.get('totalQuestions'));

      quizData.questions.forEach((q, idx) => {
        q.question = formData.get(`question-${idx}`);
        if (q.options && q.options.length > 0) {
          q.options = q.options.map((_, i) => formData.get(`option-${idx}-${i}`));
          q.answer = Number(formData.get(`answer-${idx}`));
        } else if (formData.get(`answer-${idx}`)) {
          q.answer = formData.get(`answer-${idx}`);
        }
      });

      updateJsonView();
      renderPreview();
      alert('Quiz updated successfully!');
    }

    function updateJsonView() {
      document.getElementById('jsonView').textContent = JSON.stringify(quizData, null, 2);
    }
  </script>
</body>
</html>
