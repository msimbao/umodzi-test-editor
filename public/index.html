<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Preview</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      line-height: 1.6;
    }
    .question {
      margin-bottom: 2rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 1rem;
    }
    .options {
      list-style-type: none;
      padding-left: 0;
    }
    .option {
      margin: 0.25rem 0;
      padding: 0.25rem 0.5rem;
    }
    .correct {
      background-color: #d4edda;
      font-weight: bold;
    }
    .answer {
      margin-top: 0.5rem;
      color: #0d6efd;
    }
    .math { font-style: italic; }
  </style>
</head>
<body>
  <h1 id="title">Loading...</h1>
  <p id="description"></p>
  <p><strong>Grade:</strong> <span id="grade"></span></p>
  <div id="questions"></div>

  <script>
    fetch('./quiz.json')
      .then(res => res.json())
      .then(data => {
        document.getElementById('title').textContent = data.title;
        document.getElementById('description').textContent = data.description;
        document.getElementById('grade').textContent = data.grade;

        const container = document.getElementById('questions');

        data.questions.forEach(q => {
          const div = document.createElement('div');
          div.className = 'question';

          const p = document.createElement('p');
          p.innerHTML = renderMath(q.question);
          div.appendChild(p);

          // Non-question: just show text
          if (q.non_question) {
            container.appendChild(div);
            return;
          }

          // Show options if available
          if (q.options && q.options.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'options';

            q.options.forEach((opt, i) => {
              const li = document.createElement('li');
              li.className = 'option';
              li.innerHTML = renderMath(opt);
              if (q.answer === i) {
                li.classList.add('correct');
              }
              ul.appendChild(li);
            });

            div.appendChild(ul);
          } else if (typeof q.answer === 'string' || typeof q.answer === 'number') {
            // Open-ended answer
            const answer = document.createElement('p');
            answer.className = 'answer';
            answer.innerHTML = '<strong>Answer:</strong> ' + renderMath(q.answer.toString());
            div.appendChild(answer);
          }

          container.appendChild(div);
        });

        if (window.MathJax) {
          MathJax.typesetPromise();
        }
      });

    function renderMath(text) {
      return text
        .replace(/\$\$(.*?)\$\$/g, (_, m) => `\\[${m}\\]`)
        .replace(/\$(.*?)\$/g, (_, m) => `\\(${m}\\)`)
        .replace(/\\\((.*?)\\\)/g, (_, m) => `\\(${m}\\)`);
    }
  </script>
</body>
</html>
